{% extends 'eshop/base.html' %}
{% load static %}
{% block title %}
{{ product.title }}
{% endblock %}

{% block style %}
.choice-title label {
color: #00661a;
border-radius: 8px;
border: 1px solid #00661a;
cursor: pointer;
display: inline-block;
}

.choice-title input[type=radio] {
display: none;
transition: all 200ms ease-out;
}

.choice-title input[type=radio]:hover+label {
opacity: 0.8;
border: 1px solid #00661a;
color: #00661a;
}

.choice-title input[type=radio]:checked+label {
background-color: #00661a;
color: white;
}
.carousel-control-next-icon,
.carousel-control-prev-icon {
display: none;
}

.carousel .carousel-indicators li {
width: 1rem !important;
height: 1px !important;
}


{% endblock %}

{% block body %}

<div class="container my-3">
    <div class="row">
        <div class="col-md-6">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                    {% for item in range %}
                    <li data-target="#carouselExampleIndicators" data-slide-to="{{ item }}"></li>
                    {% endfor %}
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        {% if variant.image_id > 0 %}
                        <img class="d-block w-100" src="{{ variant.image }}" alt="">
                        {% else %}
                        <img class="d-block w-100" src="{{ product.image.url }}" alt="">
                        {% endif %}
                    </div>
                    {% for item in images %}
                    <div class="carousel-item">
                        <img class="d-block w-100" src="{{ item.image.url }}" alt="">
                    </div>
                    {% endfor %}
                </div>
                {% if images.count %}
                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
                {% endif %}
            </div>
        </div>
        <div class="col-md-6">
            <br>
            <h4 class="text-success my-0 py-0"><strong>{{ product.brand_name }}</strong></h4>
            <p class="my-0 py-0">{{ product.title }}</p>
            <img style="width: 150px;"
                src="https://previews.123rf.com/images/niserin/niserin1110/niserin111000128/10859155-barcelona-spain-at-summer-very-wide-high-quality-panorama.jpg"
                alt="">
            <h3><strong> <i class="fas fa-rupee-sign    "></i> {{ product.price }}</strong> <strike class="p small"><i class="fas fa-rupee-sign    "></i>
                    {{ product.prevprice }}</strike><span class="small ml-3 text-muted">{{ product.offer|floatformat }}%
                    off</span></h3>
            {% if product.amount < product.minamount %}
            <p>Hurry! only a few left.</p>
            {% endif %}
            <!-- <p>Will be shipped in <strong>3</strong> Days</p> -->

            <script>
                $(document).on('change', '#post-form', function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'POST',
                        url: '{% url "ajaxcolor" %}',
                        data: {
                            productid: $('#productid').val(),
                            size: $('#size').val(),
                            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                            action: 'post'
                        },
                        data_type: 'html',
                        success: function (data) {
                            console.log("success");
                            $('#appendHere').html(data.rendered_table);
                        },
                        error: function (data) {
                            alert("Got an error dude " + data);
                        }
                    });
                });
            </script>

            <div class="row p-0 m-0">
                {% if product.variant == 'Size-Color' %}
                <div class="product-options">
                    <div class="size-option">
                        <form method="POST" id="post-form">
                            <input type="hidden" name="productid" id="productid" value="{{ product.id }}">
                            <span class="text-uppercase">Size :</span>
                            {% csrf_token %}
                            <select name="size" id="size">
                                {% for rs in sizes %}
                                <option {% if variant.size_id == rs.size_id %} selected {% endif %}
                                    value="{{ rs.size_id }}">{{ rs.size.name }}</option>
                                {% endfor %}
                            </select>
                        </form>
                    </div>

                    <form method="post" action="?q=selectvariant" id="post-color">
                        {% csrf_token %}
                        <div id="appendHere">
                            <input type="hidden" name="size" id="size" value="{{ size_id }}">
                            <ul class="color-option">
                                <li><span class="text-uppercase">Color:</span></li>
                                {% for rs in colors %}
                                <input type="radio" {% if variant.id == rs.id %} checked {% endif %} name="variantid"
                                    id="variantid" value="{{ rs.id }}" onchange="this.form.submit();">
                                <li {% if variant.id == rs.id %} class="active" {% endif %}>
                                    <a
                                        style="background-color:{{ rs.color.code }}; color: #D9D9D9; text-shadow: 1px 1px #000000; width: 90px">
                                        {{ rs.price }}
                                        {{ rs.color }}
                                    </a>
                                    <img src="{{ rs.image }}" style="height: 70px">
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </form>
                </div>


                {% elif product.variant == 'Size' %}
                <form method="post" action="?q=selectvariant" id="post-color">
                    {% csrf_token %}
                    <div id="appendHere">
                        <input type="hidden" name="size" id="size" value="{{ size_id }}">
                        <ul class="color-option">
                            <li><span class="text-uppercase">Size:</span></li>
                            {% for rs in sizes %}
                            <input type="radio" {% if variant.id == rs.id %} checked {% endif %} name="variantid"
                                id="variantid" value="{{ rs.id }}" onchange="this.form.submit();">
                            <li {% if variant.id == rs.id %} class="active" {% endif %}>
                                <a style=" color: #204d74;  width: 90px">
                                    ${{ rs.size }}<br> {{ rs.price }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </form>
                <br><br>

                {% elif product.variant == 'Color' %}
                <form method="post" action="?q=selectvariant" id="post-color">
                    {% csrf_token %}
                    <div id="appendHere">
                        <input type="hidden" name="size" id="size" value="{{ size_id }}">
                        <ul class="color-option">
                            <li><span class="text-uppercase">Color:</span></li>
                            {% for rs in colors %}
                            <input type="radio" {% if variant.id == rs.id %} checked {% endif %} name="variantid"
                                id="variantid" value="{{ rs.id }}" onchange="this.form.submit();">
                            <li {% if variant.id == rs.id %} class="active" {% endif %}>
                                <a
                                    style="background-color:{{ rs.color.code }}; color: #D9D9D9; text-shadow: 1px 1px #000000; width: 90px">
                                    {{ rs.price }}
                                    {{ rs.color }}
                                </a>
                                <img src="{{ rs.image }}" style="height: 70px">
                            </li>
                            {% endfor %}
                        </ul>
                    </div>

                </form>
                {% endif %}
            </div>

        </div>
        <p class="m-2"><strong>Product description:</strong></p>
        <p class="m-2">{{ product.description }}</p>
        <p class="m-2"><strong>Rating</strong></p>

        <div class="product-rating">
            <i class="fa fa-star{% if product.avaregereview < 1 %}-o empty{% endif %}"></i>
            <i class="fa fa-star{% if product.avaregereview < 2 %}-o empty{% endif %}"></i>
            <i class="fa fa-star{% if product.avaregereview < 3 %}-o empty{% endif %}"></i>
            <i class="fa fa-star{% if product.avaregereview < 4 %}-o empty{% endif %}"></i>
            <i class="fa fa-star{% if product.avaregereview < 5 %}-o empty{% endif %}"></i>
            {{ product.avaregereview|stringformat:".2f"}} | {{ product.countreview }}
            review{% if product.countreview > 1 %}s{% endif %}
        </div>

        <p class="m-2"><strong>Rate this product</strong></p>
        {% if user.id is not None %}
        <form class="review-form" action="{% url 'addReview' product.id %}" method="post">
            {% csrf_token %}
            <div class="form-group">
                <div class="input-rating">
                    <strong class="mx-2 text-uppercase">Your Rating: </strong>
                    <div class="choice-title mx-2">
                        <input type="radio" name="rate" value="1" id="rating-1"><label class="px-2 py-1"
                            for="rating-1"><i class="fa fa-star" aria-hidden="true"></i></label>
                        <input type="radio" name="rate" value="2" id="rating-2"><label class="px-2 py-1"
                            for="rating-2"><i class="fa fa-star" aria-hidden="true"></i></label>
                        <input type="radio" name="rate" value="3" id="rating-3"><label class="px-2 py-1"
                            for="rating-3"><i class="fa fa-star" aria-hidden="true"></i></label>
                        <input type="radio" name="rate" value="4" id="rating-4"><label class="px-2 py-1"
                            for="rating-4"><i class="fa fa-star" aria-hidden="true"></i></label>
                        <input type="radio" name="rate" value="5" id="rating-5"><label class="px-2 py-1"
                            for="rating-5"><i class="fa fa-star" aria-hidden="true"></i></label>
                        <button class="btn btn-sm btn-danger px-3">Submit</button>
                    </div>
                </div>
            </div>
        </form>
        {% else %}
        You must be logged in to post a review
        {% endif %}
        <br>

        {% if  product.variant != 'None'   %}

        <form action="/order/addtoshopcart/{{ product.id }}" method="post"> {% csrf_token %}
            <input type="hidden" name="variantid" id="variantid" value="{{ variant.id }}">
            <p><strong>Availability:</strong> {% if variant.quantity > 0  %} In Stock {% else %} Out of Stock
                {% endif %}</p>
            <p><strong>Selected :</strong> Size : {{ variant.size }} Color : {{ variant.color }} </p>
            <h3 class="product-price"><i class="fas fa-rupee-sign    "></i>{{ variant.price}}</h3>
            <b>Quantity: </b><input style="width: 10%;" class="input mx-1 text-center" name="quantity" type="number"
                value="1" min="1" max="{{ variant.quantity }}">
            <div class="row p-0">
                <div class="col-6 my-2">
                    <button type="submit" class="my-2 w-100 text-light bg-dark p-3 px-3 mx-0 rounded m-1"
                        style="border: none">Add to cart <i class="fas fa-shopping-bag text-white mx-2"></i></button>
                </div>
                <div class="col-6 my-2">
                    <button class="my-2 w-100 rounded ml-0 py-3 text-white m-1"
                        style="border: none;background: red;">Wish list <i class="far fa-heart text-white"></i></button>
                </div>
            </div>
        </form>
        
        {% else %}
        <form action="/order/addtoshopcart/{{ product.id }}" method="post"> {% csrf_token %}
            <p><strong>Availability:</strong> {% if product.amount > 0  %} In Stock {% else %} Out of Stock
                {% endif %}</p>
            <b>Quantity: </b><input style="width: 10%;" class="input mx-1 text-center" name="quantity" type="number"
                value="1" min="1" max="{{ product.amount }}">
            <div class="row p-0">
                <div class="col-6 my-2">
                    <button type="submit" class="my-2 w-100 text-light bg-dark p-3 px-3 mx-0 rounded m-1"
                        style="border: none">Add to cart <i class="fas fa-shopping-bag text-white mx-2"></i></button>
                </div>
                <div class="col-6 my-2">
                    <button class="my-2 w-100 rounded ml-0 py-3 text-white m-1"
                        style="border: none;background: red;">Wish list <i class="far fa-heart text-white"></i></button>
                </div>
            </div>
        </form>
        {% endif %}
    </div>
</div>
</div>
<br>
<br>
<br>
<div class="container">
    <h4><strong>See our other Products</strong></h4>
</div>
<div class="container">
    <div class="row">
        <!--Loop starts here-->
        <div class="col-6 mx-0 px-1 ">
            <a href="">
                <div class="w-100 rounded">
                    <img class="w-100 rounded" id="listimg"
                        src="https://images.unsplash.com/photo-1548378329-437e1ef34263?ixid=MXwxMjA3fDB8MHxzZWFyY2h8Mnx8ZWxlY3Ryb25pY3N8ZW58MHwxfDB8&ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60"
                        alt="">
                    <div class="px-2 pt-2 ">
                        <div>
                            <h6 class="my-0 py-0 text-success"><Strong>BRAND</Strong></h6>
                            <p class="w-100 text-dark small mb-0 pb-0">Product Name can be long</p>
                            <a class="small disabled text-dark h4 mr-1 mt-0 pt-0" href="" style="font-weight: 700;">Rs.
                                299</a>
                            <a class="small disabled text-dark mt-0 pt-0" href=""><strike>Rs. 500</strike></a>
                            <a class=" disabled text-dark mt-0 pt-0 ml-2" href="">3.4 <span
                                    class="fa fa-star text-warning"></span></a>

                        </div>
                        <button class="my-2 w-md-100 text-light bg-dark p-1 px-3 mx-0 rounded"
                            style="border: none">Buy</button>
                        <button class="my-2 rounded-circle ml-1"
                            style="border: none;height: 32px !important;width: 32px;background: red;object-fit: cover;object-position: center;"><i
                                class="far fa-heart text-white"></i></button>
                    </div>
                </div>
            </a>
            <br>
        </div>
        <!--Loop ends here-->

    </div>
</div>
{% endblock %}